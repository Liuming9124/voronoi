<!DOCTYPE html>
<html>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <head>
        <title>Voronoi Report</title>
        
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description"
        content="Voronoi diagram final report">
    </head>
    <header>
        <div class="row navbar navbar-expand-md navbar-light bg-white text-white fixed-top pt-3">
            <div class="col d-flex justify-content-center">
                <a class="navbar-brand">
                    <h3 class="text-color-1">Voronoi Report</h3>
                </a>
            </div>
            <div class="col">
                <button class="navbar-toggler" type="button"
                    data-bs-toggle="collapse" data-bs-target="#navbar"
                    aria-controls="navbar" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span
                        class="navbar-toggler-icon bg-primary bg-body-secondary "></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="#softwareRule">軟體規格書</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="#softwareIntro"
                                href="/">軟體說明</a></li>
                        <li class="nav-item"><a class="nav-link" href="#codeDesign"
                                href="/">程式設計</a></li>
                        <li class="nav-item"><a class="nav-link" href="#testResult"
                                href="/">軟體測試及實驗結果</a></li>
                        <li class="nav-item"><a class="nav-link" href="#conclusion"
                                href="/">結論與心得</a></li>
                        <li class="nav-item"><a class="nav-link" href="#appendix"
                                href="/">附錄</a></li>
                    </ul>
                </div>
            </div>
            <!-- <div class="col d-flex justify-content-end pe-5">
                <a class="btn btn-outline-color-5" href="/">M133040015</a>
            </div> -->
        </div>
    <br>
    <br>
    <br>
    </header>
    <body class="p-5 bg-color bg-light">


        <div class="container px-5">
            <p>題目: Voronoi Diagram 實作報告</p>
            <p>系級: 資訊工程研究所113級</p>
            <p>姓名: 劉恭銘</p>
            <p>學號: M133040015</p>
            <hr>
        </div>


        <div class="container px-5" id="softwareRule">
            <p class="fs-3 fw-bold">軟體規格書</p>
            <p>：包含「輸出與輸入（資料）規格」、「功能規格與介面規格」、「軟體測試規劃書」與其他有利於軟體開發之規格。</p>
            <p class="fs-5 fw-bold">輸入規格:</p>
            <ul>
                <li>可在畫布上隨意點擊，畫布大小至少為 600 x 600。</li>
                <li>支援讀入測試資料檔案，每檔案包含多組座標點。</li>
                <li>輸入資料格式：
                    <ul>
                        <li>每組測試資料以數字開頭，代表點的數量。</li>
                        <li>後續每行為一個點的座標，格式為 <code>x y</code>。</li>
                    </ul>
                </li>
            </ul>
            <p class="fs-5 fw-bold">輸出規格:</p>
            <ul>
                <li>於畫布上繪製 Voronoi 圖形，包含點及其對應的邊界。</li>
                <li>輸出包含點與邊界的結果檔案，格式如下：
                    <ul>
                        <li><code>P x y</code>：每個點佔一行，兩整數 x, y 為座標。</li>
                        <li><code>E x1 y1 x2 y2</code>：線段的起點和終點，x1≦x2 或 x1=x2, y1≦y2。</li>
                    </ul>
                </li>
                <li>輸出文字檔案內容：
                    <ul>
                        <li>座標點排列在前半段，以 lexical order 排序（先排序 x，若相同再排序 y）。</li>
                        <li>線段排列在後半段，按 x1, y1, x2, y2 的順序進行字典序排序。</li>
                    </ul>
                </li>
                <li>範例輸出檔案內容：
                    <div class="card" style="width: 18rem;">
                        <p class="px-3">
                            P 103 200 <br>
                            P 193 64 <br>
                            P 193 370 <br>
                            P 283 200 <br>
                            E 0 34 193 161 <br>
                            E 0 363 193 261 <br>
                            E 193 161 193 261 <br>
                            E 193 161 437 0 <br>
                            E 193 261 600 476
                        </p>
                    </div>
                </li>
            </ul>
            
            <p class="fs-5 fw-bold">功能規格:</p>
            <ul>
                <li>手動點擊畫布以新增點。</li>
                <li>點擊<b>Read File</b>讀入測試資料檔案以生成 Voronoi 圖形。
                    <ul>
                        <li>點擊<b>NextGraph</b>依序測資順序循環呈現測試資料</li>
                    </ul>
                </li>
                <li>支援兩種執行模式：
                    <ul>
                        <li><b>Run 模式：</b>從當時的狀態執行至最後並將最終結果畫出。</li>
                        <li><b>Step by Step 模式：</b>每次 merge 之前暫停，並以不同顏色顯示左右兩個 Voronoi 圖形。</li>
                        <ul>
                            <li>先點擊<b>Step by Step</b>乙次。</li>
                            <li>持續點擊<b>Continue</b>以階段呈現merge過程。</li>
                            <li>當完成Voronoi Diagram後，需再次點擊<b>Step by Step</b>重置。</li>
                        </ul>
                    </ul>
                </li>
                <li>點擊<b>Write File</b>可將結果輸出至文字檔案，包含點與邊界資訊。</li>
                <li>支援讀入已生成的輸出檔案並顯示其對應的 Voronoi 圖形。</li>
                <li>點擊<b>Clear</b>清除所有畫布資訊並重置操作。</li>
            </ul>
        
            <p class="fs-5 fw-bold">介面規格:</p>            
            <ul>
                <p>介面</p>
                <img src="./static/imgs/interface.png" alt="UI_interface" width="500px">                
            </ul>

            <p class="fs-5 fw-bold">軟體測試規劃書:</p>
            <hr>
        </div>


        <div class="container px-5" id="softwareIntro">
            <p class="fs-3 fw-bold">軟體說明</p>
            <table class="table table-bordered">
                <tr>
                    <th>項目</th>
                    <th>說明</th>
                </tr>
                <tr>
                    <td>程式語言</td>
                    <td>Python</td>
                </tr>
                <tr>
                    <td>編譯器</td>
                    <td>Python 3.11.4</td>
                </tr>
                <tr>
                    <td>相依套件</td>
                    <td>
                        <ul>
                            <li>tkinter</li>
                            <li>math</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>編譯方式</td>
                    <td>
                        <ul>
                            <li>安裝pyinstaller套件</li>
                            <li>執行指令: pyinstaller --onefile --windowed [檔案名稱]</li>
                        </ul>
                    </td>
                </tr>
            </table>
            <hr>
        </div>



        <div class="container  px-5" id="codeDesign">
            <p class="fs-3 fw-bold">程式設計</p>
                <p>：將演算法於程式設計中，需要使用的資料結構，所需注意的細節或特別的技巧，在此部分講述。如果演算法有改良之處，亦在此描述。</p>
                <p class="fs-4">Class</p>
                    <ul>
                        <li><b>Voronoi</b>
                            <p>此Class主要處理與Vornoi Diagram相關的功能，舉例:</p>
                            <ul>
                                <li>解voronoi diagram</li>
                                <li>convex hull</li>
                                <li>devide and conquer</li>
                                <li>hyper plane</li>
                            </ul>
                        </li>
                        <li><b>Graph</b>
                            <p>此Class主要處理與Graph相關的功能，舉例:</p>
                            <ul>
                                <li>計算line兩端點的最大邊界</li>
                                <li>裁切線段回傳畫布上兩端點</li>
                                <li>新增、紀錄點線</li>
                                <li>找出線段交點</li>
                                <li>與線段相關的功能</li>
                            </ul>
                        </li>
                        <li><b>Uiapp</b>
                            <p>此Class主要處理與UI相關的功能，舉例:</p>
                            <ul>
                                <li>處理button的點擊及call function</li>
                                <li>處理Interrupt</li>
                                <li>處理Input及Output</li>
                            </ul>
                        </li>
                    </ul>
                <hr>


                <p class="fs-4">資料結構</p>
                <ul>
                    <li><p class="fs-5">點</p></li>
                        <p>點的資料結構為一個list，存放每個點的座標，格式為[(x, y), ..., (x, y)]。</p>
                        <p>點的id資料結構為一個list，存放每個點的id，格式為[id, ..., id]。</p>
                    <li><p class="fs-5">線段</p></li>
                        <p>線段的資料結構為一個list，存放每條線段的資訊，格式為</p>
                        <p>[[draw1, draw2, point_a, point_b, edge_piont1, edge_point2, id],...]。</p>
                    <ul>
                        <li>draw1, draw2</li>
                            <p>draw1, draw2為畫布上的線段兩端點。</p>
                        <li>point_a, point_b</li>
                            <p>point_a, point_b為畫布上的兩點畫出來的Voronoi線段。</p>
                        <li>edge_piont1, edge_point2</li>
                            <p>edge_piont1, edge_point2為超出畫布外但仍為此線段的兩端點。</p>
                        <li>id</li>
                            <p>id為線段的id。</p>
                    </ul>
                </ul>
                <hr>


            <p class="fs-4">演算法</p>
                <div class="px-2">
                    
                    <p class="fs-5 fw-bold">三點以下: 暴力解</p>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>一個點</strong>
                                <p class="ms-4 mb-0">一個點不存在 Voronoi 線段，因此回傳 Voronoi 空集合。</p>
                            </li>
                            <li class="list-group-item">
                                
                                <div class="row">

                                    <div class="col">
                                        <strong>兩個點</strong>
                                        <p class="ms-4 mb-0">兩個點的 Voronoi 線段為兩點的中垂線。</p>
                                    </div>

                                    <div class="col d-flex justify-content-center">
                                        <img src="./static/imgs/vor2points.png" alt="acute_triangle" width="300px">
                                    </div>

                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">

                                    <div class="col">
                                        <strong>三個點</strong>
                                        <p class="ms-4 mb-0">
                                            <ol>
                                                <li>判斷三角形的類型，若為三點共線須進行例外處理(回傳兩條Voronoi線段: 由三點中的中間頂點與另外兩點的中垂腺)</li>
                                                <li>找出三角形的外心，外心為三點的垂直平分線的交點</li>
                                                <li><b>銳角三角形</b>：由外心向三頂點的射線為 Voronoi 線段</li>
                                                <li><b>鈍角三角形</b>：與 3-1 不同之處在於其中一條 Voronoi 線段會由外心遠離兩個銳角頂點，形成與鈍角頂點相對的線段</li>
                                            </ol>
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="col d-flex m-3 justify-content-center">
                                    <div class="row">
                                        <div class="col">
                                            <img src="./static/imgs/vor3pointsonline.png" alt="acute_triangle" width="350px">
                                        </div>
                                        <div class="col">
                                            <img src="./static/imgs/vor3pointsnormal.png" alt="acute_triangle" width="350px">
                                        </div>
                                        <div class="col">
                                            <img src="./static/imgs/vor3points.png" alt="acute_triangle" width="350px">
                                        </div>
                                    </div>
                                </div>

                            </li>
                        </ul>
                        <br><br>
                    

                    <p class="fs-5 fw-bold">四點以上: Devide and conquer</p>

                        <div class="container mt-4">
                        
                            <!-- Divide Section -->
                            <div class="mt-4">
                                <p class="fs-5 mb-3">分割 (Divide)</p>
                                <div class="list-group">
                                    <div class="list-group-item">
                                        <p class="fs-5 fw-bold">步驟</p>
                                        <p class="ms-4 mb-0">將所有點依據 <strong>x 座標排序</strong>，並將點分為左右兩個子集合並回傳。</p>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- Merge Section -->
                            <div class="mt-4">
                                <p class="fs-5 mb-3">合併 (Merge)</p>
                                <ol class="list-group list-group-numbered">
                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">Convex Hull</p>
                                        <p>
                                            使用 <strong>Graham's Scan</strong> 演算法計算凸包。具體步驟如下：
                                        </p>
                                        <ol class="ms-2">
                                            <li>找到最左下的點作為基準點。</li>
                                            <li>將其他點按相對基準點的極角進行排序，若角度相同則按距離排序。</li>
                                            <li>依次遍歷排序後的點，使用 <strong>叉積 (Cross Product)</strong> 判斷點是否形成逆時針方向的凸包邊界。</li>
                                            <li>如果形成順時針方向，移除最後加入的點，確保邊界是凸的。</li>
                                        </ol>
                                        <p>最終結果為一個封閉的凸包，包含所有點。</p>
                                    </li>
                        
                                    
                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">合併凸包</p>

                                        <ul>
                                            <li>將左右兩部分的頂點集合進行合併。</li>
                                            <li>重新對合併後的點集進行凸包計算（使用 Graham's Scan）。</li>
                                            <li>合併後的凸包包含所有輸入點的外部邊界。</li>
                                        </ul>
                                        <br>

                                        <p>
                                            此部分的時候我沒有依序由左Convex Hull最右點及右Convex Hull最左點順逆時針刪除造訪到的點，
                                            而是直接將左右Convex Hull的點全部合併，並重新呼叫Convex Hull函數，找出新的Convex Hull，此部分可以再改善。
                                        </p>
                                    </li>


                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">找出上下切線</p>
                                        <p>
                                            對合併後的左右凸包，找到其 <strong>上公切線</strong> 和 <strong>下公切線</strong>，具體步驟如下：
                                        </p>
                                        <ol class="ms-4">
                                            <li>
                                                <strong>下公切線</strong>：
                                                <ul>
                                                    <li>從左凸包的最右點和右凸包的最左點開始。</li>
                                                    <li>固定右側點，調整左側點，使切線方向順時針旋轉。</li>
                                                    <li>固定左側點，調整右側點，使切線方向逆時針旋轉。</li>
                                                    <li>直到左右兩邊的點不再移動，即確定下公切線。</li>
                                                </ul>
                                            </li>
                                            <li>
                                                <strong>上公切線</strong>：
                                                <ul>
                                                    <li>從左凸包的最右點和右凸包的最左點開始。</li>
                                                    <li>固定右側點，調整左側點，使切線方向逆時針旋轉。</li>
                                                    <li>固定左側點，調整右側點，使切線方向順時針旋轉。</li>
                                                    <li>直到左右兩邊的點不再移動，即確定上公切線。</li>
                                                </ul>
                                            </li>
                                        </ol>
                                        <p>
                                            <strong>例外情況處理：</strong><br>
                                            當兩個凸包的點共線時（即切線與一條邊完全重合）：
                                        </p>
                                        <ul>
                                            <li>程式檢查三個點是否共線（切線的兩端點與第三點），並計算點與邊的相對位置。</li>
                                            <li>如果三點共線，切線會選擇遠離另一側凸包的方向，避免重複或錯誤計算。</li>
                                            <li>當切線完全共線且有多個候選點時，程式會選擇最靠外的點作為最終的切線端點。</li>
                                        </ul>
                                        <p>
                                            這種處理方式保證了切線的正確性，避免因共線情況導致的邊界錯誤。
                                        </p>
                                    </li>


                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">計算中間的垂直平分線（Hyperplane）</p>
                                        <p>對下公切線與上公切線進行處理，找到其垂直平分線，這是左右兩部分 Voronoi Diagram 的分界線。</p>
                                        <p>使用一條由下公切線開始，垂直向上的射線，逐步向上找到各條垂直平分線。</p>
                                    </li>
                        

                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">處理相交點與線段</p>
                                        <p>垂直平分線向上延伸時，可能與左右兩邊的 Voronoi 線段相交。</p>
                                        <ul>
                                            <li>對每個相交點進行處理。</li>
                                            <li>刪除遠離垂直平分線的 Voronoi 線段。</li>
                                            <li>將新的線段加入合併後的 Voronoi Diagram。</li>
                                        </ul>
                                    </li>
                        

                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">清理孤立線段</p>
                                        <p>在合併過程中，可能出現孤立的 Voronoi 線段（例如，兩端都無法與其他線段相連的線段）。</p>
                                        <p>將這些孤立線段刪除，保證合併後的 Voronoi Diagram 正確無誤。</p>
                                    </li>
                        

                                    <li class="list-group-item">
                                        <p class="fs-5 fw-bold">整合結果</p>
                                        <p>最終的合併結果包括：</p>
                                        <ul>
                                            <li>左右兩部分的 Voronoi Diagram。</li>
                                            <li>新計算出的垂直平分線。</li>
                                        </ul>
                                        <p>整合後形成完整的 Voronoi Diagram，覆蓋所有輸入的點。</p>
                                    </li>
                                </ol>
                            </div>
                        
                            <!-- Visual Flow Section -->
                            <p class="fs-5 mt-4">視覺化流程</p>
                            <ul class="list-group">
                                <li class="list-group-item">分割為左右兩部分，各自生成 Voronoi Diagram。</li>
                                <li class="list-group-item">找到上下公切線，作為兩部分的初步連接。</li>
                                <li class="list-group-item">逐步修剪與延伸，形成完整的合併結果。</li>
                            </ul>
                        
                            <div class="row mt-3">
                                <div class="col-md-4 text-center">
                                    <img src="./static/imgs/voronoi-divide-step.png" alt="Step 1" class="img-fluid rounded">
                                    <p class="mt-2">分割步驟</p>
                                </div>
                                <div class="col-md-4 text-center">
                                    <img src="./static/imgs/voronoi-merge-step.png" alt="Step 2" class="img-fluid rounded">
                                    <p class="mt-2">合併步驟</p>
                                </div>
                                <div class="col-md-4 text-center">
                                    <img src="./static/imgs/voronoi-final-result.png" alt="Step 3" class="img-fluid rounded">
                                    <p class="mt-2">完整結果</p>
                                </div>
                            </div>
                        </div>
                        


                </div>

            <hr>
        </div>


        <div class="container px-5" id="testResult">
            <p class="fs-3 fw-bold">軟體測試與實驗結果：</p>
            <p>
                軟體之測試報告。包含測試的環境、使用的電腦硬體系統（CPU型號、記憶體容量等）、作業系統、編譯器名稱及版本。然後列出測試數據。
                必須列出程式可以執行之範例數據（最好列出程式可以執行之極限數據）。
                如果有些情況無法執行，請列出可能原因及可能解決之道。並請提供測試時之「測試輸入檔」與「測試輸出檔」。
            </p>
            <hr>
        </div>


        <div class="container px-5" id="conclusion">
            <p class="fs-3 fw-bold">結論與心得</p>
            <p>：說明所得結論、可以改良之處與心得等。</p>
            <hr>
        </div>


        <div class="container px-5" id="appendix">
            <p class="fs-3 fw-bold">附錄</p>
            <p>：請連結「程式原始碼合併檔」、「測試輸入檔」、「測試輸出檔」等與報告相關之資料。</p>
            <hr>
        </div>
        
    </body>
    <footer>

    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.1/dist/umd/popper.min.js" integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script>
</html>